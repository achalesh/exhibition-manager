<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Book a Stall</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container mt-4">

  <!-- Navigation Bar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
    <div class="container-fluid">
      <a class="navbar-brand" href="/">Exhibition App</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav">
          <li class="nav-item"><a class="nav-link" href="/">Dashboard</a></li>
          <li class="nav-item"><a class="nav-link" href="/pavilion/add">Add Pavilion</a></li>
          <li class="nav-item"><a class="nav-link" href="/stall/add">Add Stall</a></li>
          <li class="nav-item"><a class="nav-link active" href="/booking/add">Book Stall</a></li>
          <li class="nav-item"><a class="nav-link" href="/booking/list">View Bookings</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Page Header -->
  <h2 class="mb-3">Book a Stall</h2>

  <form method="POST" action="/booking/add" class="needs-validation" novalidate>
  <!-- Exhibiter Info -->
  <div class="mb-3">
    <label class="form-label">Exhibiter Name</label>
    <input type="text" class="form-control" name="client_name" required>
  </div>

  <div class="mb-3">
    <label class="form-label">Contact Info</label>
    <input type="text" class="form-control" name="contact">
  </div>

  <!-- Stall Selection -->
  <div class="mb-3">
    <label class="form-label">Allotted Place</label>
    <select name="stall_id" class="form-select" required>
      <option value="" disabled selected>Select Stall</option>
      <% stalls.forEach(s => { %>
        <option value="<%= s.id %>"><%= s.name %></option>
      <% }) %>
    </select>
  </div>

  <!-- Rent & Discount -->
  <div class="mb-3">
  <label class="form-label">Rent Amount (₹)</label>
  <input type="number" class="form-control" id="rent_amount" name="rent_amount" required min="0">
</div>

<div class="mb-3">
  <label class="form-label">Discount (₹)</label>
  <input type="number" class="form-control" id="discount" name="discount" value="0" min="0">
</div>

<div class="mb-3">
  <label class="form-label">Total Rent After Discount (₹)</label>
  <input type="number" class="form-control" id="total" name="total" readonly>
</div>

  <button type="submit" class="btn btn-success">✅ Book Stall</button>
  <a href="/" class="btn btn-secondary ms-2">⬅️ Back to Dashboard</a>
</form>

  <!-- Bootstrap JS for navbar toggle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Client-side validation -->
  <script>
    (() => {
      'use strict';
      const forms = document.querySelectorAll('.needs-validation');
      Array.from(forms).forEach(form => {
        form.addEventListener('submit', event => {
          if (!form.checkValidity()) {
            event.preventDefault();
            event.stopPropagation();
          }
          form.classList.add('was-validated');
        }, false);
      });
    })();
  </script>
<script>
  function calculateTotal() {
    const rent = parseFloat(document.getElementById('rent_amount').value) || 0;
    const discount = parseFloat(document.getElementById('discount').value) || 0;
    const total = Math.max(rent - discount, 0); // Prevent negative totals
    document.getElementById('total').value = total;
  }

  document.getElementById('rent_amount').addEventListener('input', calculateTotal);
  document.getElementById('discount').addEventListener('input', calculateTotal);
</script>
</body>
</html>