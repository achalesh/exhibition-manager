<%- include('partials/header') %>

<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2><%= title %></h2>
    <a href="/staff/add" class="btn btn-primary">Add New Staff</a>
  </div>

  <!-- Role Filter Dropdown -->
  <div class="row mb-3">
    <div class="col-md-4">
      <label for="role-select" class="form-label">Filter by Role</label>
      <select id="role-select" class="form-select">
        <option value="all" <%= currentRole === 'all' ? 'selected' : '' %>>All Staff</option>
        <option value="Booking" <%= currentRole === 'Booking' ? 'selected' : '' %>>Booking Staff</option>
        <option value="Amusement" <%= currentRole === 'Amusement' ? 'selected' : '' %>>Amusement Staff</option>
        <option value="Electrical" <%= currentRole === 'Electrical' ? 'selected' : '' %>>Electrical Staff</option>
        <option value="Cleaning" <%= currentRole === 'Cleaning' ? 'selected' : '' %>>Cleaning Staff</option>
        <option value="Office" <%= currentRole === 'Office' ? 'selected' : '' %>>Office Staff</option>
        <option value="Security" <%= currentRole === 'Security' ? 'selected' : '' %>>Security Staff</option>
      </select>
    </div>
  </div>

  <div class="card">
    <div class="card-body">
      <table class="table table-hover align-middle">
        <thead class="table-light">
          <tr>
            <th>Photo</th>
            <th>Name</th>
            <th>Date of Birth</th>
            <th>Role</th>
            <th>Contact</th>
            <th>Aadhaar</th>
            <th>Address</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% if (staff && staff.length > 0) { %>
            <% staff.forEach(person => { %>
              <tr>
                <td>
                  <img src="<%= person.photo_path || '/images/default-avatar.png' %>" alt="Staff Photo" class="img-thumbnail" style="width: 60px; height: 60px; object-fit: cover;">
                </td>
                <td><strong><%= person.name %></strong></td>
                <td><%= person.dob ? new Date(person.dob).toLocaleDateString() : 'N/A' %></td>
                <td><span class="badge bg-secondary"><%= person.role || 'N/A' %></span></td>
                <td><%= person.phone %><% if (person.secondary_phone) { %><br><span class="text-muted"><%= person.secondary_phone %></span><% } %></td>
                <td><%= person.aadhaar || 'N/A' %></td>
                <td><%= person.address || 'N/A' %></td>
                <td>
                  <a href="/staff/id-card/<%= person.id %>" target="_blank" class="btn btn-sm btn-info">
                    Print ID
                  </a>
                </td>
              </tr>
            <% }); %>
          <% } else { %>
            <tr>
              <td colspan="8" class="text-center text-muted">No staff members found for this role.</td>
            </tr>
          <% } %>
        </tbody>
      </table>
    </div>
  </div>
</div>

<script>
  document.getElementById('role-select').addEventListener('change', function() {
    window.location.href = '/staff/list?role=' + this.value;
  });
</script>

<%- include('partials/footer') %>