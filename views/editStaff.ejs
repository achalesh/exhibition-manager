<%- include('partials/header') %>

<%
  // Determine if the form should be read-only.
  // Data cannot be edited when viewing an archived session.
  const isReadOnly = viewingSession.id !== activeSession.id;
%>

<div class="container-fluid">
  <h1 class="h3 mb-4 text-gray-800"><%= title %></h1>

  <div class="card shadow-sm mb-4">
    <div class="card-header py-3">
      <h6 class="m-0 fw-bold text-primary">Update Staff Details</h6>
    </div>
    <div class="card-body">
      <% if (error) { %>
        <div class="alert alert-danger"><%= error %></div>
      <% } %>
      <form action="/staff/edit/<%= staff.id %>" method="POST" enctype="multipart/form-data">
        <input type="hidden" name="existing_photo_path" value="<%= staff.photo_path %>">
        <div class="row g-3">
          <div class="col-md-6">
            <label for="name" class="form-label">Full Name <span class="text-danger">*</span></label>
            <input type="text" class="form-control" id="name" name="name" value="<%= staff.name %>" required <%- isReadOnly ? 'readonly' : '' %>>
          </div>
          <div class="col-md-6">
            <label for="role" class="form-label">Role <span class="text-danger">*</span></label>
            <select id="role" name="role" class="form-select" required <%- isReadOnly ? 'disabled' : '' %>>
              <option value="Booking" <%= staff.role === 'Booking' ? 'selected' : '' %>>Booking</option>
              <option value="Electric" <%= staff.role === 'Electric' ? 'selected' : '' %>>Electric</option>
              <option value="Material" <%= staff.role === 'Material' ? 'selected' : '' %>>Material</option>
              <option value="Other" <%= staff.role === 'Other' ? 'selected' : '' %>>Other</option>
            </select>
          </div>
          <div class="col-md-6">
            <label for="phone" class="form-label">Primary Phone <span class="text-danger">*</span></label>
            <input type="tel" class="form-control" id="phone" name="phone" value="<%= staff.phone %>" required <%- isReadOnly ? 'readonly' : '' %>>
          </div>
          <div class="col-md-6">
            <label for="secondary_phone" class="form-label">Secondary Phone</label>
            <input type="tel" class="form-control" id="secondary_phone" name="secondary_phone" value="<%= staff.secondary_phone || '' %>" <%- isReadOnly ? 'readonly' : '' %>>
          </div>
          <div class="col-md-6">
            <label for="dob" class="form-label">Date of Birth</label>
            <input type="date" class="form-control" id="dob" name="dob" value="<%= staff.dob || '' %>" <%- isReadOnly ? 'readonly' : '' %>>
          </div>
          <div class="col-md-6">
            <label for="aadhaar" class="form-label">Aadhaar Number</label>
            <input type="text" class="form-control" id="aadhaar" name="aadhaar" value="<%= staff.aadhaar || '' %>" pattern="\d{12}" title="Aadhaar must be 12 digits" <%- isReadOnly ? 'readonly' : '' %>>
          </div>
          <div class="col-12">
            <label for="address" class="form-label">Full Address</label>
            <textarea class="form-control" id="address" name="address" rows="3" <%- isReadOnly ? 'readonly' : '' %>><%= staff.address || '' %></textarea>
          </div>
          <div class="col-md-6">
            <label for="photo" class="form-label">Update Photo</label>
            <input type="file" class="form-control" id="photo" name="photo" accept="image/*" <%- isReadOnly ? 'disabled' : '' %>>
          </div>
          <div class="col-md-6">
            <% if (staff.photo_path) { %>
              <label class="form-label">Current Photo</label>
              <img src="<%= staff.photo_path %>" alt="Staff Photo" class="img-thumbnail" style="max-height: 100px;">
            <% } %>
          </div>
        </div>
        <% if (!isReadOnly) { %>
          <button type="submit" class="btn btn-primary mt-3">Update Staff</button>
        <% } %>
        <a href="/staff/list" class="btn btn-secondary mt-3">Cancel</a>
      </form>
    </div>
  </div>
</div>

<%- include('partials/footer') %>