<%- include('partials/header') %>

<%- include('partials/ticketingSubNav') %>

<div class="container-fluid mt-4">
  <div class="card shadow-sm">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h4 class="mb-0"><%= title %></h4>
      <button class="btn btn-sm btn-outline-secondary" onclick="window.print();"><i class="bi bi-printer me-1"></i> Print Report</button>
    </div>
    <div class="card-body">

      <!-- Summary Cards -->
      <div class="row g-3 mb-4 text-center">
        <div class="col-md-3">
          <div class="card bg-primary-subtle h-100">
            <div class="card-body">
              <h6 class="card-subtitle mb-2 text-muted">Total Revenue</h6>
              <h4 class="card-title">₹<%= grandTotal.revenue.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) %></h4>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card bg-info-subtle h-100">
            <div class="card-body">
              <h6 class="card-subtitle mb-2 text-muted">Total Tickets Sold</h6>
              <h4 class="card-title"><%= grandTotal.tickets.toLocaleString('en-IN') %></h4>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card bg-success-subtle h-100">
            <div class="card-body">
              <h6 class="card-subtitle mb-2 text-muted">Total Cash</h6>
              <h4 class="card-title">₹<%= grandTotal.cash.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) %></h4>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card bg-warning-subtle h-100">
            <div class="card-body">
              <h6 class="card-subtitle mb-2 text-muted">Total UPI</h6>
              <h4 class="card-title">₹<%= grandTotal.upi.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) %></h4>
            </div>
          </div>
        </div>
      </div>

      <!-- Filter Form -->
      <form method="GET" action="/ticketing/report/daily" class="row g-3 align-items-end bg-light p-3 rounded mb-4">
        <div class="col-md-4">
          <label for="start_date" class="form-label">Start Date</label>
          <input type="date" class="form-control" id="start_date" name="start_date" value="<%= filters.start_date %>">
        </div>
        <div class="col-md-4">
          <label for="end_date" class="form-label">End Date</label>
          <input type="date" class="form-control" id="end_date" name="end_date" value="<%= filters.end_date %>">
        </div>
        <div class="col-md-4 d-flex gap-2">
          <button type="submit" class="btn btn-primary flex-grow-1">Filter</button>
          <a href="/ticketing/report/daily" class="btn btn-secondary flex-grow-1">Clear</a>
        </div>
      </form>

      <!-- Sales Data -->
      <% if (Object.keys(salesByDate).length > 0) { %>
        <% Object.entries(salesByDate).forEach(([date, data]) => { %>
          <div class="card mb-4">
            <div class="card-header bg-light">
              <h5 class="mb-0">Sales for: <%= new Date(date + 'T00:00:00').toLocaleDateString('en-IN', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }) %></h5>
            </div>
            <div class="table-responsive">
              <table class="table table-striped table-bordered mb-0">
                <thead class="table-dark">
                  <tr>
                    <th>Ride/Type</th>
                    <th class="text-end">Rate</th>
                    <th class="text-end">Tickets Sold</th>
                    <th class="text-end">Cash</th>
                    <th class="text-end">UPI</th>
                    <th class="text-end">Total Revenue</th>
                  </tr>
                </thead>
                <tbody>
                  <% data.rides.forEach(ride => { %>
                    <tr>
                      <td><%= ride.ride_name %></td>
                      <td class="text-end">₹<%= ride.rate.toFixed(2) %></td>
                      <td class="text-end"><%= ride.total_tickets_sold %></td>
                      <td class="text-end">₹<%= ride.total_cash.toFixed(2) %></td>
                      <td class="text-end">₹<%= ride.total_upi.toFixed(2) %></td>
                      <td class="text-end">₹<%= ride.total_revenue.toFixed(2) %></td>
                    </tr>
                  <% }); %>
                </tbody>
                <tfoot class="table-group-divider fw-bold">
                  <tr>
                    <td colspan="2" class="text-end">Daily Total:</td>
                    <td class="text-end"><%= data.daily_total_tickets %></td>
                    <td class="text-end">₹<%= data.daily_total_cash.toFixed(2) %></td>
                    <td class="text-end">₹<%= data.daily_total_upi.toFixed(2) %></td>
                    <td class="text-end">₹<%= data.daily_total_revenue.toFixed(2) %></td>
                  </tr>
                </tfoot>
              </table>
            </div>
          </div>
        <% }); %>
      <% } else { %>
        <div class="alert alert-info text-center">No sales data found for the selected period.</div>
      <% } %>
    </div>
  </div>
</div>

<%- include('partials/footer') %>