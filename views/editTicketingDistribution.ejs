<%- include('partials/header') %>

<%- include('partials/ticketingSubNav') %>

<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><%= title %></h5>
                </div>
                <div class="card-body">
                    <p><strong>Ticket Book:</strong> <%= distribution.color %> | <%= distribution.distributed_start_number %> - <%= distribution.distributed_end_number %></p>
                    <hr>
                    <form action="/ticketing/distribute/edit/<%= distribution.id %>" method="POST">
                        <div class="mb-3">
                            <label for="ride_id" class="form-label">Change Ride/Ticket Type</label>
                            <select class="form-select" id="ride_id" name="ride_id" required>
                                <% rides.forEach(ride => { %>
                                    <% if (ride.rate == distribution.rate) { %>
                                        <option value="<%= ride.id %>" <%= distribution.rate_id === ride.id ? 'selected' : '' %>>
                                            <%= ride.name %> (₹<%= ride.rate %>)
                                        </option>
                                    <% } %>
                                <% }); %>
                            </select>
                            <div class="form-text">Only rides with the same ticket rate (₹<%= distribution.rate %>) are shown.</div>
                        </div>

                        <div class="mb-3">
                            <label for="staff_id" class="form-label">Change Assigned Staff</label>
                            <select class="form-select" id="staff_id" name="staff_id" required>
                                <% staff.forEach(s => { %>
                                    <option value="<%= s.id %>" <%= distribution.staff_id === s.id ? 'selected' : '' %>>
                                        <%= s.name %>
                                    </option>
                                <% }); %>
                            </select>
                        </div>

                        <div class="d-flex justify-content-between">
                            <a href="/ticketing/distribute" class="btn btn-secondary">Cancel</a>
                            <button type="submit" class="btn btn-primary">Update Distribution</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<%- include('partials/footer') %>