<%- include('partials/header') %>

<div class="container-fluid">
  <%- include('partials/ticketingNav') %>

  <div class="card shadow-sm mb-4">
    <div class="card-header py-3">
      <h6 class="m-0 fw-bold text-primary">Edit Imported Sale</h6>
    </div>
    <div class="card-body">
      <p class="text-muted">Use this form to correct a historical sales record.</p>
      <form action="/ticketing/import/edit/<%= sale.id %>" method="POST">
        <div class="row g-3 align-items-end">
          <div class="col-md-3">
            <label for="settlement_date" class="form-label">Sale Date</label>
            <input type="date" class="form-control" id="settlement_date" name="settlement_date" value="<%= sale.settlement_date %>" required>
          </div>
          <div class="col-md-3">
            <label for="ride_name" class="form-label">Ticket Type (Ride Name)</label>
            <input type="text" class="form-control" id="ride_name" name="ride_name" value="<%= sale.ride_name %>" required>
          </div>
          <div class="col-md-3">
            <label for="rate" class="form-label">Rate (₹)</label>
            <input type="number" class="form-control" id="rate" name="rate" value="<%= sale.rate %>" required>
          </div>
          <div class="col-md-3">
            <label for="tickets_sold" class="form-label">Number of Tickets Sold</label>
            <input type="number" class="form-control" id="tickets_sold" name="tickets_sold" value="<%= sale.tickets_sold %>" required min="1">
          </div>
        </div>
        <div class="row g-3 align-items-end mt-2">
          <div class="col-md-3">
            <label for="upi_amount" class="form-label">UPI Amount Received</label>
            <input type="number" step="0.01" class="form-control" id="upi_amount" name="upi_amount" value="<%= sale.upi_amount %>" min="0">
          </div>
          <div class="col-md-3">
            <label class="form-label">Cash Amount</label>
            <input type="text" class="form-control" id="cash_amount_display" readonly>
          </div>
          <div class="col-md-3">
            <button type="submit" class="btn btn-primary w-100">Update Imported Sale</button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const rateInput = document.getElementById('rate');
    const ticketsSoldInput = document.getElementById('tickets_sold');
    const upiInput = document.getElementById('upi_amount');
    const cashDisplay = document.getElementById('cash_amount_display');

    function calculateRevenue() {
      const selectedRate = parseFloat(rateInput.value) || 0;
      const ticketsSold = parseInt(ticketsSoldInput.value) || 0;
      const totalRevenue = selectedRate * ticketsSold;
      const upiAmount = parseFloat(upiInput.value) || 0;
      const cashAmount = totalRevenue - upiAmount;
      cashDisplay.value = '₹' + cashAmount.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    }

    [rateInput, ticketsSoldInput, upiInput].forEach(el => el.addEventListener('input', calculateRevenue));
    calculateRevenue(); // Initial calculation on page load
  });
</script>

<%- include('partials/footer') %>