<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title><%= title %></title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <style>
    body {
      background-color: #f8f9fa;
      font-family: 'Times New Roman', Times, serif;
    }
    .receipt-container {
      max-width: 800px;
      margin: 2rem auto;
      border: 1px solid #dee2e6;
      padding: 2.5rem;
      background-color: #fff;
    }
    .receipt-header {
      text-align: center;
      margin-bottom: 2rem;
      border-bottom: 1px solid #dee2e6;
      padding-bottom: 1rem;
    }
    .receipt-header img {
      max-height: 60px;
      margin-bottom: 0.5rem;
    }
    .receipt-footer {
      margin-top: 3rem;
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
      font-size: 0.9rem;
      color: #6c757d;
    }
    @media print {
      @page {
        size: A5 portrait;
        margin: 1cm;
      }
      body {
        background-color: #fff;
        font-size: 12pt;
      }
      .receipt-container {
        margin: 0;
        border: none;
        padding: 0;
        box-shadow: none;
      }
      .no-print {
        display: none;
      }
    }
  </style>
</head>
<body>
  <div class="receipt-container">
    <div class="receipt-header">
      <% if (viewingSession.logo_path) { %>
        <img src="<%= viewingSession.logo_path %>" alt="Logo">
      <% } %>
      <h2 class="fw-bold mb-1"><%= viewingSession.name %></h2>
      <p class="text-muted mb-2"><%= viewingSession.address %>, <%= viewingSession.location %></p>
      <h4 class="text-decoration-underline">PAYMENT RECEIPT</h4>
    </div>

    <div class="row mb-4">
      <div class="col-6">
        <p class="mb-1"><strong>Receipt No:</strong> <%= payment.receipt_number || payment.id %></p>
        <p class="mb-1"><strong>Date:</strong> <%= new Date(payment.payment_date).toLocaleDateString('en-IN') %></p>
      </div>
      <div class="col-6 text-end">
        <p class="mb-1"><strong>Received From:</strong> M/s <%= payment.exhibitor_name %></p>
        <p class="mb-1"><strong>Space:</strong> <%= payment.space_name %></p>
      </div>
    </div>

    <% 
      let description = 'Payment';
      let totalAmount = payment.cash_paid + payment.upi_paid;
      if (payment.rent_paid > 0) { description = 'Towards Rent Charges'; }
      else if (payment.electric_paid > 0) { description = 'Towards Electricity Charges'; }
      else if (payment.material_paid > 0) { description = 'Towards Material Charges'; }
      else if (payment.shed_paid > 0) { description = 'Towards Shed Rent'; }

      // Helper function to convert number to words
      function numberToWords(num) {
        const a = ['', 'one', 'two', 'three', 'four', 'five', 'six', 'seven', 'eight', 'nine', 'ten', 'eleven', 'twelve', 'thirteen', 'fourteen', 'fifteen', 'sixteen', 'seventeen', 'eighteen', 'nineteen'];
        const b = ['', '', 'twenty', 'thirty', 'forty', 'fifty', 'sixty', 'seventy', 'eighty', 'ninety'];
        if ((num = num.toString()).length > 9) return 'overflow';
        const n = ('000000000' + num).substr(-9).match(/^(\d{2})(\d{2})(\d{2})(\d{1})(\d{2})$/);
        if (!n) return;
        let str = '';
        str += (n[1] != 0) ? (a[Number(n[1])] || b[n[1][0]] + ' ' + a[n[1][1]]) + ' crore ' : '';
        str += (n[2] != 0) ? (a[Number(n[2])] || b[n[2][0]] + ' ' + a[n[2][1]]) + ' lakh ' : '';
        str += (n[3] != 0) ? (a[Number(n[3])] || b[n[3][0]] + ' ' + a[n[3][1]]) + ' thousand ' : '';
        str += (n[4] != 0) ? (a[Number(n[4])] || b[n[4][0]] + ' ' + a[n[4][1]]) + ' hundred ' : '';
        str += (n[5] != 0) ? ((str != '') ? 'and ' : '') + (a[Number(n[5])] || b[n[5][0]] + ' ' + a[n[5][1]]) : '';
        return str.trim().replace(/\s+/g, ' ');
      }
      const amountInWords = numberToWords(Math.floor(totalAmount));
    %>

    <table class="table table-bordered">
      <thead class="table-light">
        <tr>
          <th>Description</th>
          <th class="text-end" style="width: 25%;">Amount (₹)</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>
            <p class="mb-1"><%= description %></p>
            <p class="text-muted small mb-0">
              Paid via: <%= payment.payment_mode %>
              <% if (payment.payment_mode === 'Cash & UPI') { %>
                (Cash: ₹<%= payment.cash_paid.toFixed(2) %>, UPI: ₹<%= payment.upi_paid.toFixed(2) %>)
              <% } %>
            </p>
          </td>
          <td class="text-end align-middle">
            <%= totalAmount.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) %>
          </td>
        </tr>
      </tbody>
      <tfoot class="fw-bold">
        <tr>
          <td class="text-end">Total Paid</td>
          <td class="text-end">₹<%= totalAmount.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) %></td>
        </tr>
      </tfoot>
    </table>

    <div class="mt-3">
      <strong>Amount in Words:</strong>
      <span class="text-capitalize"><em><%= amountInWords %> Rupees Only.</em></span>
    </div>

    <div class="receipt-footer">
      <div>
        <p class="mb-0"><em>This is a computer-generated receipt.</em></p>
        <button class="btn btn-primary no-print mt-3" onclick="window.print()"><i class="bi bi-printer me-1"></i>Print Receipt</button>
      </div>
      <div class="text-end">
        <p class="mb-4">For <%= viewingSession.name %></p>
        <p class="mb-0">_________________________</p>
        <p>Authorised Signatory</p>
      </div>
    </div>
  </div>
</body>
</html>