<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title><%= title %></title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .receipt-container {
            max-width: 800px;
            margin: 2rem auto;
            background: white;
            border: 1px solid #dee2e6;
            box-shadow: 0 0 15px rgba(0,0,0,0.05);
        }
        .receipt-header {
            padding: 2rem;
            border-bottom: 2px solid #000;
            text-align: center;
        }
        .receipt-header .logo-circle {
            width: 100px;
            height: 100px;
            background-color: #000;
            border-radius: 50%;
            display: inline-flex;
            justify-content: center;
            align-items: center;
            margin: 0 auto 1rem auto;
            overflow: hidden;
        }
        .receipt-header .logo-circle img {
            max-width: 90%;
            max-height: 90%;
        }
        .receipt-header img {
            max-height: 80px;
            margin-bottom: 1rem;
        }
        .receipt-body {
            padding: 2rem;
        }
        .receipt-footer {
            padding: 3rem 2rem 2rem;
            text-align: right;
        }
        .print-button-container {
            text-align: center;
            padding: 2rem;
        }

        @media print {
            body {
                background-color: white;
            }
            .receipt-container {
                margin: 0;
                border: none;
                box-shadow: none;
                max-width: 100%;
            }
            .no-print {
                display: none !important;
            }
        }
    </style>
</head>
<body>

    <div class="receipt-container">
        <div class="receipt-header">
            <% if (viewingSession.logo_path) { %>
                <div class="logo-circle">
                    <img src="<%= viewingSession.logo_path %>" alt="Logo">
                </div>
            <% } %>
            <h2><%= viewingSession.name %></h2>
            <p class="lead mb-0"><%= viewingSession.address %></p>
        </div>

        <div class="receipt-body">
            <div class="text-center mb-4">
                <h3 class="text-decoration-underline">PAYMENT RECEIPT</h3>
            </div>

            <div class="row mb-4">
                <div class="col-6">
                    <p><strong>Receipt No:</strong> <%= payment.receipt_number || payment.id %></p>
                </div>
                <div class="col-6 text-end">
                    <p><strong>Date:</strong> <%= new Date(payment.payment_date).toLocaleDateString() %></p>
                </div>
            </div>

            <div class="mb-4">
                <p class="mb-1"><strong>Received from:</strong></p>
                <div class="ps-3">
                    <p class="mb-0 fw-bold"><%= payment.exhibitor_name %></p>
                    <p class="mb-0">Facia: <%= payment.facia_name || 'N/A' %></p>
                    <p class="mb-0">Space: <%= payment.space_name %></p>
                </div>
            </div>

            <% 
                let paymentFor = 'Unknown';
                let amount = 0;
                if (payment.rent_paid > 0) { paymentFor = 'Rent'; amount = payment.rent_paid; }
                else if (payment.electric_paid > 0) { paymentFor = 'Electric Bill'; amount = payment.electric_paid; }
                else if (payment.material_paid > 0) { paymentFor = 'Material Charges'; amount = payment.material_paid; }
                else if (payment.shed_paid > 0) { paymentFor = 'Shed Rent'; amount = payment.shed_paid; }
            %>

            <table class="table table-bordered">
                <thead class="table-light">
                    <tr>
                        <th>Description</th>
                        <th class="text-end">Amount (₹)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Payment towards <%= paymentFor %></td>
                        <td class="text-end"><%= amount.toFixed(2) %></td>
                    </tr>
                </tbody>
                <tfoot>
                    <tr>
                        <td class="text-end"><strong>Total</strong></td>
                        <td class="text-end"><strong>₹<%= amount.toFixed(2) %></strong></td>
                    </tr>
                </tfoot>
            </table>

            <div class="mt-3">
                <p><strong>Amount in words:</strong> <span id="amount-in-words" class="fw-bold text-capitalize"></span></p>
                <p><strong>Payment Mode:</strong> <%= payment.payment_mode %></p>
            </div>
        </div>

        <div class="receipt-footer">
            <p class="mb-0">_________________________</p>
            <p><strong>Authorized Signatory</strong></p>
        </div>
    </div>

    <div class="print-button-container no-print">
        <button class="btn btn-primary" onclick="window.print()"><i class="bi bi-printer me-2"></i>Print Receipt</button>
        <a href="javascript:history.back()" class="btn btn-secondary">Back</a>
    </div>

<script>
    // Simple number to words converter (supports up to lakhs for Indian currency)
    function numberToWords(num) {
        const a = ['', 'one', 'two', 'three', 'four', 'five', 'six', 'seven', 'eight', 'nine', 'ten', 'eleven', 'twelve', 'thirteen', 'fourteen', 'fifteen', 'sixteen', 'seventeen', 'eighteen', 'nineteen'];
        const b = ['', '', 'twenty', 'thirty', 'forty', 'fifty', 'sixty', 'seventy', 'eighty', 'ninety'];
        
        function inWords(n) {
            if (n < 20) return a[n];
            let digit = n % 10;
            return b[Math.floor(n / 10)] + (digit ? ' ' + a[digit] : '');
        }

        if (num === 0) return 'zero';
        let words = '';
        if (num >= 100000) {
            words += inWords(Math.floor(num / 100000)) + ' lakh ';
            num %= 100000;
        }
        if (num >= 1000) {
            words += inWords(Math.floor(num / 1000)) + ' thousand ';
            num %= 1000;
        }
        if (num >= 100) {
            words += inWords(Math.floor(num / 100)) + ' hundred ';
            num %= 100;
        }
        if (num > 0) {
            words += (words ? 'and ' : '') + inWords(num);
        }
        return words.trim();
    }

    const amount = <%= amount %>;
    document.getElementById('amount-in-words').textContent = numberToWords(Math.floor(amount)) + ' rupees only.';
</script>

</body>
</html>